{% extends "base.html" %}
{% block header_title %}Новый заказ{% endblock %}

{% block content %}
<div class="main__order-wrapper">
    <form id="order-form" method="post" action="/api/orders/">
        <div class="main__order-wrapper-blocks">
            <div class="main__order-settings">
                <div class="main__order-header">
                    <div class="main__order-header-item">
                        <p>Заказ №</p>
                        <input type="text" id="order-number" name="order_number" readonly class="main__btn-short" value="{{ order_number }}">
                    </div>
                    <div class="main__order-header-item">
                        <p>Дата время</p>
                        <input type="text" id="order-date" name="order_date" readonly class="main__btn-short" value="{{ now.strftime('%d.%m.%y') }}">
                        <input type="text" id="order-time" name="order_time" readonly class="main__btn-short" value="{{ now.strftime('%H:%M') }}">
                    </div>
                    <div class="main__order-header-item">
                        <p>Путевой лист</p>
                        <input type="text" id="route-number" name="route_number" readonly class="main__btn-short" value="{{ route_number }}">
                    </div>
                </div>
                <div class="main__order-subheader">
                    <div class="main__order-subheader-item">
                        <select id="driver-select" name="driver_id" class="main__btn-short">
                            <option value disabled selected>Выберите водителя</option>
                            {% for driver in drivers %}
                            <option value="{{ driver.id }}" data-phone="{{ driver.phone|default('+996 (XXX) XX-XX-XX') }}" data-tariff="{{ driver.tariff }}">
                                {{ driver.full_name }}
                            </option>
                            {% endfor %}
                        </select>
                        <input type="text" id="driver-phone" readonly class="main__btn-short" value="+996 (XXX) XX-XX-XX">
                    </div>
                    <div class="main__order-subheader-item">
                        <div class="main__subheader-filing">
                            <select id="tariff-select" name="tariff">
                                <option value disabled selected>Вариант</option>
                                <option value="Эконом">Эконом</option>
                                <option value="Комфорт">Комфорт</option>
                                <option value="Комфорт+">Комфорт+</option>
                                <option value="Бизнес">Бизнес</option>
                            </select>
                        </div>
                        <div class="main__subheader-filing">
                            <select id="payment-method" name="payment_method">
                                <option value disabled selected>Оплата</option>
                                <option value="Наличные">Наличные</option>
                                <option value="На карту">На карту</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="main__order-details">
                    <div class="main__order-details-item main__order-details-where">
                        <input type="text" id="origin-street" name="origin_street" placeholder="Улица откуда" class="main__btn" />
                        <input type="text" id="origin-house" name="origin_house" placeholder="Дом" class="main__btn" />
                        <input type="text" id="origin-district" name="origin_district" placeholder="Район" class="main__btn" />
                        <input type="hidden" id="origin-full" name="origin" />
                    </div>
                    <div class="main__order-details-item main__order-details-whither">
                        <input type="text" id="destination-street" name="destination_street" placeholder="Улица куда" class="main__btn" />
                        <input type="text" id="destination-house" name="destination_house" placeholder="Дом" class="main__btn" />
                        <input type="text" id="destination-district" name="destination_district" placeholder="Район" class="main__btn" />
                        <input type="hidden" id="destination-full" name="destination" />
                    </div>
                </div>
                <div class="main__order-notes">
                    <div class="main__order-notes-text">
                        <textarea id="notes" name="notes" placeholder="Примечание"></textarea>
                    </div>
                    <div class="main__order-notes-settings">
                        <button type="button" class="main__btn-short">Заказ другому человеку</button>
                        <button type="button" class="main__btn-short">Дополнительные услуги</button>
                    </div>
                </div>
                <div class="main__table">
                    <table>
                        <thead>
                            <tr>
                                <th>Заказ</th>
                                <th>Время</th>
                                <th>Откуда</th>
                                <th>Куда</th>
                                <th>Сумма</th>
                            </tr>
                        </thead>
                        <tbody id="recent-orders">
                            {% if orders %}
                            {% for order in orders %}
                            <tr>
                                <td>{{ order.id }}</td>
                                <td>{{ order.time }} {{ order.created_at.strftime('%d.%m.%y') }}</td>
                                <td>{{ order.origin }}</td>
                                <td>{{ order.destination }}</td>
                                <td>{{ order.price|default('') }}</td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="5">Нет данных о последних заказах</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="main__order-map">
                <div class="main__order-map-item" id="map-container">
                    <!-- 2ГИС карта будет загружена сюда -->
                </div>
                <div class="main__order-map-settings">
                    <div class="main__order-map-settings">
                        <button type="button" class="main__btn">Данные для рассчета</button>
                    </div>
                    <div class="route-info">
                        <div class="route-info-item">
                            <input type="text" id="tariff-display" readonly class="main__btn-short" value="Эконом">
                        </div>
                        <div class="route-info-item">
                            <input type="text" id="boarding-fee" readonly class="main__btn-short" value="Посадка: 48 сом">
                        </div>
                        <div class="route-info-item">
                            <input type="text" id="distance" readonly class="main__btn-short" value="Расстояние: 0 км">
                        </div>
                        <div class="route-info-item">
                            <input type="text" id="price" readonly class="main__btn-short" value="Стоимость: 0 сом">
                            <input type="hidden" id="calculated-price" name="price" value="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="main__order-wrapper-btn">
            <button type="submit" class="main__btn-green">Заказать</button>
            <button type="button" id="cancel-btn" class="main__btn">Отменить</button>
        </div>
    </form>
</div>

<!-- Подключение 2ГИС MapGL JS API -->
<script src="https://mapgl.2gis.com/api/js/v1"></script>
<script>
    // Ждём загрузки DOM и jQuery
    document.addEventListener('DOMContentLoaded', function() {
        // Ждём также загрузки jQuery
        function waitForJQuery() {
            if (typeof $ !== 'undefined') {
                initApp();
            } else {
                setTimeout(waitForJQuery, 100);
            }
        }
        waitForJQuery();
    });

    function initApp() {
        console.log('jQuery готов');
        
        // Константы для тарифов
        const TARIFFS = {
            'Эконом': {
                boardingFee: 48,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 5,
                cityPricePerKm: 8.5,
                cityPricePerMinute: 3.9,
                outsideCityPricePerKm: 23,
                outsideCityPricePerMinute: 3.9
            },
            'Комфорт': {
                boardingFee: 60,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 6,
                cityPricePerKm: 10.5,
                cityPricePerMinute: 4.9,
                outsideCityPricePerKm: 25,
                outsideCityPricePerMinute: 4.9
            },
            'Комфорт+': {
                boardingFee: 75,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 6.5,
                cityPricePerKm: 13,
                cityPricePerMinute: 6.2,
                outsideCityPricePerKm: 28,
                outsideCityPricePerMinute: 6.2
            },
            'Бизнес': {
                minimumPrice: 80,
                boardingFee: 80,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 7,
                cityPricePerKm: 14,
                cityPricePerMinute: 6.5,
                outsideCityPricePerKm: 30,
                outsideCityPricePerMinute: 6.5
            }
        };
        
        // Функция обновления времени (Киргизское время, GMT+6)
        function updateKyrgyzTime() {
            try {
                const now = new Date();
                // Получаем UTC время и добавляем 6 часов для Киргизии (GMT+6)
                const kyrgyzTime = new Date(now.getTime() + (6 * 60 * 60 * 1000));
                
                const orderTimeElement = document.getElementById('order-time');
                if (orderTimeElement) {
                    orderTimeElement.value = kyrgyzTime.toLocaleTimeString('ru-RU', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false,
                        timeZone: 'Asia/Bishkek'
                    });
                }
            } catch (error) {
                console.error('Ошибка при обновлении времени:', error);
            }
        }
        
        updateKyrgyzTime();
        setInterval(updateKyrgyzTime, 1000);

        // Переменные для карты 2ГИС MapGL
        let map;
        let originMarker;
        let destinationMarker;
        let routeLayer;
        let distance = 0;
        let duration = 0;
        let originCoords = null;
        let destinationCoords = null;

        // Инициализация карты 2ГИС MapGL
        function initMap() {
            try {
                console.log('Инициализация карты 2ГИС MapGL...');
                
                // Проверяем, что MapGL доступен
                if (typeof mapgl === 'undefined') {
                    console.error('MapGL API не загружен');
                    return;
                }
                
                // Центр города Ош, Киргизия
                const oshCenter = [72.8019, 40.5138]; // [lng, lat] для MapGL - город Ош
                
                map = new mapgl.Map('map-container', {
                    center: oshCenter,
                    zoom: 12, // Увеличиваем зум для города
                    key: '3025505a-cdb6-4ddc-819b-1c546552efe3',
                    minZoom: 5,
                    maxZoom: 18
                });
                
                console.log('Карта 2ГИС MapGL создана для города Ош');

                // Добавляем обработчик правой кнопки мыши для выбора точек
                map.on('contextmenu', function(e) {
                    const coords = e.lngLat;
                    
                    // Проверяем, что координаты находятся в пределах Киргизии
                    if (isWithinKyrgyzstan(coords.lat, coords.lng)) {
                        console.log('Клик правой кнопкой по координатам в Киргизии:', coords.lat, coords.lng);
                        showContextMenu(coords, e.originalEvent);
                    } else {
                        alert('Выберите точку на территории Киргизии');
                    }
                });
                
                console.log('Карта 2ГИС MapGL успешно инициализирована для города Ош');
            } catch (error) {
                console.error('Ошибка при инициализации карты 2ГИС MapGL:', error);
            }
        }

        // Проверка, находится ли точка в пределах Киргизии
        function isWithinKyrgyzstan(lat, lng) {
            return (lat >= 39.2 && lat <= 43.3 && lng >= 69.2 && lng <= 80.3);
        }

        // Функция для отображения контекстного меню
        function showContextMenu(coords, event) {
            try {
                // Удаляем предыдущее меню, если оно есть
                $('.map-context-menu').remove();
                
                const menuDiv = $(`
                    <div class="map-context-menu">
                        <div class="map-context-menu-item" data-action="origin">Установить точку отправления</div>
                        <div class="map-context-menu-item" data-action="destination">Установить точку назначения</div>
                    </div>
                `);
                
                // Позиционируем меню
                menuDiv.css({
                    position: 'fixed',
                    left: event.clientX + 'px',
                    top: event.clientY + 'px',
                    backgroundColor: '#2d2e33',
                    border: '1px solid #47484c',
                    borderRadius: '5px',
                    padding: '5px 0',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.3)',
                    zIndex: 1000,
                    color: '#fff'
                });
                
                $('body').append(menuDiv);
                
                // Обработчики для пунктов меню
                menuDiv.find('.map-context-menu-item').hover(
                    function() { $(this).css('backgroundColor', '#47484c'); },
                    function() { $(this).css('backgroundColor', 'transparent'); }
                ).css({
                    padding: '8px 12px',
                    cursor: 'pointer'
                }).click(function() {
                    const action = $(this).data('action');
                    setMarkerByClick(coords, action);
                    $('.map-context-menu').remove();
                });
                
                // Закрываем меню при клике вне его
                $(document).one('click', function() {
                    $('.map-context-menu').remove();
                });
                
            } catch (error) {
                console.error('Ошибка при отображении контекстного меню:', error);
            }
        }
        
        // Функция для установки маркера при клике
        function setMarkerByClick(coords, type) {
            console.log('Установка маркера', type, 'по координатам в Киргизии:', coords.lat, coords.lng);
            
            // Простое использование координат без геокодирования
            const address = `${coords.lat.toFixed(6)}, ${coords.lng.toFixed(6)}`;
                    
            // Устанавливаем маркер
            if (type === 'origin') {
                if (originMarker) {
                    originMarker.destroy();
                }
                
                originCoords = [coords.lng, coords.lat]; // Сохраняем координаты
                originMarker = new mapgl.Marker(map, {
                    coordinates: originCoords,
                    icon: 'https://docs.2gis.com/img/nav-gp-pin.svg'
                });
                
                // Заполняем поля адреса
                $('#origin-street').val(address);
                $('#origin-full').val(address);
                        
            } else if (type === 'destination') {
                if (destinationMarker) {
                    destinationMarker.destroy();
                }
                
                destinationCoords = [coords.lng, coords.lat]; // Сохраняем координаты
                destinationMarker = new mapgl.Marker(map, {
                    coordinates: destinationCoords,
                    icon: 'https://docs.2gis.com/img/nav-gp-pin.svg'
                });
                
                // Заполняем поля адреса
                $('#destination-street').val(address);
                $('#destination-full').val(address);
            }
                    
            // Обновляем маршрут, если оба адреса установлены
            if ($('#origin-full').val() && $('#destination-full').val()) {
                calculateRoute();
            }
        }

        // Расчет маршрута
        function calculateRoute() {
            try {
                console.log('Расчет маршрута через 2ГИС MapGL');
                const origin = $('#origin-full').val();
                const destination = $('#destination-full').val();
            
                if (!origin || !destination) {
                    console.log('Не заданы начальная или конечная точки маршрута');
                    return;
                }
            
                // Простой расчет расстояния (примерный)
                if (originCoords && destinationCoords) {
                    // Расчет расстояния по прямой (в километрах)
                    distance = calculateDistance(originCoords[1], originCoords[0], destinationCoords[1], destinationCoords[0]);
                    // Примерное время в минутах (средняя скорость 30 км/ч в городе)
                    duration = (distance / 30) * 60;
                    
                    console.log('Расстояние:', distance.toFixed(1), 'км, время:', duration.toFixed(0), 'мин');
                    
                    $('#distance').val(`Расстояние: ${distance.toFixed(1)} км`);
                    
                    // Пересчитываем стоимость
                    calculatePrice();
                    
                    // Показываем линию маршрута
                    if (routeLayer) {
                        routeLayer.destroy();
                    }
                    
                    routeLayer = new mapgl.Polyline(map, {
                        coordinates: [originCoords, destinationCoords],
                        color: '#00FFFC',
                        width: 5
                    });
                    
                    // Подстраиваем карту под маршрут
                    const bounds = [
                        [Math.min(originCoords[0], destinationCoords[0]), Math.min(originCoords[1], destinationCoords[1])],
                        [Math.max(originCoords[0], destinationCoords[0]), Math.max(originCoords[1], destinationCoords[1])]
                    ];
                    map.fitBounds(bounds, { padding: 50 });
                }
            } catch (error) {
                console.error('Ошибка расчета маршрута:', error);
            }
        }

        // Функция расчета расстояния между двумя точками
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Радиус Земли в км
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Расчет стоимости поездки
        function calculatePrice() {
            try {
                const tariff = $('#tariff-select').val();
                console.log('Расчет цены для тарифа:', tariff);
                
                if (!tariff || !TARIFFS[tariff]) {
                    console.error('Тариф не выбран или не найден в списке тарифов:', tariff);
                    return;
                }

                const tariffData = TARIFFS[tariff];
                let price = tariffData.boardingFee;
                
                // Обновляем отображение тарифа
                $('#tariff-display').val(tariff);
                
                // Расчет стоимости в зависимости от расстояния
                if (distance > 0) {
                    const pricePerKm = tariffData.cityPricePerKm;
                    const pricePerMinute = tariffData.cityPricePerMinute;
                    
                    const distancePrice = distance * pricePerKm;
                    const timePrice = duration * pricePerMinute;
                    
                    price += distancePrice + timePrice;
                }
                
                // Минимальная стоимость для бизнес-класса
                if (tariff === 'Бизнес' && price < tariffData.minimumPrice) {
                    price = tariffData.minimumPrice;
                }
                
                // Округляем до целого числа
                price = Math.ceil(price);
                
                $('#price').val(`Стоимость: ${price} сом`);
                $('#calculated-price').val(price);
                $('#boarding-fee').val(`Посадка: ${tariffData.boardingFee} сом`);
                
                console.log('Расчет стоимости:', {
                    тариф: tariff,
                    расстояние: distance.toFixed(1) + ' км',
                    время: duration.toFixed(0) + ' мин',
                    цена: price + ' сом'
                });
            } catch (error) {
                console.error('Ошибка при расчете стоимости:', error);
            }
        }

        // Инициализация карты при загрузке страницы
        $(window).on('load', function() {
            console.log('Страница полностью загружена, инициализация карты...');
            setTimeout(function() {
                try {
                    initMap();
                    console.log('Карта инициализирована после загрузки страницы');
                } catch (error) {
                    console.error('Ошибка инициализации карты после загрузки страницы:', error);
                }
            }, 500);
        });

        // Обработчики событий
        $('#driver-select').change(function() {
            const selectedOption = $(this).find('option:selected');
            const phone = selectedOption.data('phone');
            const tariff = selectedOption.data('tariff');
            
            $('#driver-phone').val(phone);
            
            if (tariff) {
                $('#tariff-select').val(tariff);
                $('#tariff-select').trigger('change');
            }
        });

        $('#tariff-select').change(function() {
            try {
                const tariff = $(this).val();
                console.log('Изменение тарифа на:', tariff);
                
                if (tariff) {
                    $('#tariff-display').val(tariff);
                    calculatePrice();
                }
            } catch (error) {
                console.error('Ошибка при изменении тарифа:', error);
            }
        });
        
        // Обновление адресов при заполнении домов и районов
        $('#origin-house, #origin-district').on('change keyup', function() {
            updateFullAddress('origin');
        });
        
        $('#destination-house, #destination-district').on('change keyup', function() {
            updateFullAddress('destination');
        });
        
        // Валидация адресов для Киргизии при ручном вводе
        $('#origin-street, #destination-street').on('blur', function() {
            const address = $(this).val().toLowerCase();
            if (address && !isKyrgyzstanAddress(address)) {
                alert('Пожалуйста, введите адрес на территории Киргизии');
                $(this).focus();
            }
        });
        
        // Проверка, относится ли адрес к Киргизии
        function isKyrgyzstanAddress(address) {
            const kyrgyzstanKeywords = [
                'кыргызстан', 'киргизия', 'бишкек', 'ош', 'джалал-абад', 
                'каракол', 'нарын', 'талас', 'баткен', 'чуй', 'иссык-куль',
                'кг', 'kg', 'bishkek', 'osh', 'jalal-abad', 'karakol', 
                'naryn', 'talas', 'batken', 'чолпон-ата', 'кербен'
            ];
            
            return kyrgyzstanKeywords.some(keyword => address.includes(keyword));
        }
        
        function updateFullAddress(type) {
            const street = $(`#${type}-street`).val();
            const house = $(`#${type}-house`).val();
            const district = $(`#${type}-district`).val();
            
            let fullAddress = street;
            if (house) fullAddress += `, ${house}`;
            if (district) fullAddress += `, ${district}`;
            
            // Проверяем, что адрес относится к Киргизии
            if (fullAddress && !isKyrgyzstanAddress(fullAddress.toLowerCase())) {
                alert('Адрес должен находиться на территории Киргизии');
                return;
            }
            
            $(`#${type}-full`).val(fullAddress);
            
            if ($('#origin-full').val() && $('#destination-full').val()) {
                calculateRoute();
            }
        }
        
        // Обработка формы
        $('#order-form').submit(function(e) {
            e.preventDefault();
            
            const driverId = $('#driver-select').val();
            const tariff = $('#tariff-select').val();
            const paymentMethod = $('#payment-method').val();
            const origin = $('#origin-full').val();
            const destination = $('#destination-full').val();
            
            if (!driverId) {
                alert('Выберите водителя');
                return false;
            }
            if (!tariff) {
                alert('Выберите тариф');
                return false;
            }
            if (!paymentMethod) {
                alert('Выберите способ оплаты');
                return false;
            }
            if (!origin) {
                alert('Укажите адрес отправления');
                return false;
            }
            if (!destination) {
                alert('Укажите адрес назначения');
                return false;
            }
            
            // Проверяем, что адреса находятся в пределах Киргизии
            if (!isKyrgyzstanAddress(origin.toLowerCase())) {
                alert('Адрес отправления должен находиться на территории Киргизии');
                return false;
            }
            if (!isKyrgyzstanAddress(destination.toLowerCase())) {
                alert('Адрес назначения должен находиться на территории Киргизии');
                return false;
            }
            
            // Отправка формы
            $.ajax({
                type: 'POST',
                url: '/api/orders/',
                data: $(this).serialize(),
                success: function(response) {
                    alert('Заказ успешно создан!');
                    window.location.href = '/disp/';
                },
                error: function(error) {
                    alert('Ошибка при создании заказа: ' + (error.responseJSON ? error.responseJSON.detail : 'Проверьте соединение с сервером'));
                }
            });
        });
        
        // Отмена заказа
        $('#cancel-btn').click(function() {
            if (confirm('Вы уверены, что хотите отменить создание заказа?')) {
                window.location.href = '/disp/';
            }
        });
        
        // Нажатие клавиши F2 для создания нового заказа
        $(document).keydown(function(e) {
            if (e.keyCode === 113) { // F2 key
                e.preventDefault();
                window.location.reload();
            }
        });
    } // Закрытие функции initApp
</script>
<style>
    /* Адаптивные стили */
    .main__order-wrapper {
        border-radius: 5px;
    }
    .main__order-header {
        flex-wrap: wrap;
    }
    .main__btn {
        padding: 12px 30px;
    }
    .main__order-subheader {
        gap: 20px;
        flex-wrap: wrap;
    }
    .main__order-subheader-item {
        width: 100%;
    } 
    .main__subheader-filing {
        width: 100%;
    }
    #tariff-select,
    #payment-method {
        width: 100%;
    }
    .main__order-subheader-item .main__btn-short {
        width: 100%;
    }
    .main__order-notes {
        width: 100%;
        display: flex;
        justify-content: space-between;
    } 
    .main__order-notes-text {
        width: 65%;
    }
    @media (max-width: 1200px) {
        .main__order-wrapper-blocks {
            flex-direction: column;
        }
        .main__order-settings, .main__order-map {
            width: 100%;
            margin-bottom: 20px;
        }
        .main__header-tags ul li {
            padding: 10px 15px;
        }
    }
    
    @media (max-width: 768px) {
        .main__header {
            flex-direction: column;
            align-items: flex-start;
        }
        .main__header-logo, .main__header-tags, .main__header-search {
            width: 100%;
            margin-bottom: 10px;
        }
        .main__subheader-add {
            flex-wrap: wrap;
        }
        .main__order-header, .main__order-subheader {
            flex-direction: column;
        }
        .main__order-header-item, .main__order-subheader-item {
            width: 100%;
            margin-bottom: 10px;
        }
        .main__order-details-item {
            flex-direction: column;
        }
        .main__order-details-item input {
            width: 100%;
            margin-bottom: 10px;
        }
        .main__order-map-item {
            height: 300px;
        }
    }
    
    /* Улучшения существующих стилей */
    .main__order-map-item {
        min-height: 400px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .main__btn, .main__btn-short, .main__btn-green {
        transition: all 0.3s ease;
    }
    
    .main__btn:hover, .main__btn-short:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .main__btn-green:hover {
        background-color: #35a63a;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .main__order-notes-text textarea {
        width: 100%;
        min-height: 80px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #47484c;
        background-color: #2d2e33;
        color: #fff;
        resize: vertical;
    }
    
    /* Улучшения для карты и маршрута */
    .route-info {
        background-color: #2d2e33;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }
    
    .route-info-item {
        background-color: #47484c;
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 10px;
        width: 100%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .route-info-item input {
        width: 90%;
    }
    
    /* Стили для контекстного меню карты */
    .map-context-menu {
        background-color: #2d2e33;
        border: 1px solid #47484c;
        border-radius: 5px;
        padding: 5px 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        z-index: 1000;
        color: #fff;
    }
    
    .map-context-menu-item {
        padding: 8px 12px;
        cursor: pointer;
        color: #fff;
    }
    
    .map-context-menu-item:hover {
        background-color: #47484c;
    }
    
    @media (max-width: 576px) {
        .route-info-item {
            width: 100%;
        }
    }
</style>
{% endblock %}