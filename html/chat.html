<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Чат - taxi.wazir.kg</title>
        <link rel="stylesheet" href="./assets/css/main.css">
        <style>
            .chat-textarea {
                width: 100%;
                height: 150px;
                padding: 15px;
                background-color: #2a2a2e;
                border-radius: 10px;
                border: none;
                color: #fff;
                font-size: 16px;
                resize: none;
                margin-bottom: 15px;
                font-family: inherit;
                box-sizing: border-box;
            }

            .chat-textarea:focus {
                outline: none;
                background-color: #32323a;
            }

            .chat-textarea::placeholder {
                color: #a0a0a0;
            }
        </style>
    </head>
    <body>
        <div class="wrapper">
            <div class="navbar__settings navbar__menu">
                <div class="navbar__menu-links">
                    <h4>Информация</h4>
                    <nav>
                        <ul>
                            <li><a href="#">Документы</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="navbar__menu-links">
                    <h4>Техподдержка</h4>
                    <nav>
                        <ul>
                            <li><a href="#">Техподдержка</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="navbar__menu-info navbar__menu">
                <div class="navbar__menu-links">
                    <h4>Диспетчерская</h4>
                    <nav>
                        <ul>
                            <li><a href="./analytics.html">Статистика</a></li>
                            <li><a href="./get_balance.html">Запрос на
                                    баланс</a></li>
                            <li><a href="./new_order.html">Новый заказ</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="navbar__menu-links">
                    <h4>Автопарк</h4>
                    <nav>
                        <ul>
                            <li><a href="./drivers_control_edit.html">Создание
                                    водителя</a></li>
                            <li><a href="./pay_balance.html">Пополнение
                                    баланса</a></li>
                            <li><a href="./drivers.html">Водители</a></li>
                            <li><a
                                    href="./cars.html">Автомобили</a></li>
                            <li><a href="./chat.html">Чат</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="navbar__menu-links">
                    <h4>Контроль</h4>
                    <nav>
                        <ul>
                            <li><a href="./drivers_control.html">Фото
                                    контроль</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="navbar__menu-settings navbar__menu">
                <div class="navbar__menu-links">
                    <h4>Основные</h4>
                    <nav>
                        <ul>
                            <li><a href="#">Профиль партнера</a></li>
                            <li><a href="#">Категория транзакций</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="navbar__menu-links"
                    style="position: absolute; bottom: 10%;">
                    <h4>Интерфейс</h4>
                    <div class="main__subheader-filing">
                        <h4>Язык Интерфейса</h4>
                        <form action="#">
                            <select name="filing-date"
                                style="width: 100%;">
                                <option value="Русский">Русский</option>
                                <option value="Киргизский">Киргизский</option>
                            </select>
                        </form>
                    </div>
                    <div class="main__subheader-filing">
                        <h4>Тема</h4>
                        <form action="#">
                            <select name="filing-date"
                                style="width: 100%;">
                                <option value="Ночная Тема">Ночная Тема</option>
                                <option value="Светлая Тема">Светлая
                                    Тема</option>
                            </select>
                        </form>
                    </div>
                </div>
            </div>
            <div class="navbar">
                <div class="navbar__content">
                    <div class="navbar__logo">
                        <a href="./index.html"><img
                                src="./assets/img/logo/logo_small.png"
                                alt="logo"></a>
                    </div>
                    <div class="navbar__links">
                        <div class="navbar__links-content">
                            <a class="navbar__links-content-active"
                                href="#"><img
                                    src="./assets/img/ico/disp.png"
                                    alt="disp"></a>
                            <a href="#"><img src="./assets/img/ico/maps.png"
                                    alt="maps"></a>
                            <a href="./drivers.html"><img
                                    src="./assets/img/ico/user.png"
                                    alt="user"></a>
                            <a href="./cars.html"><img
                                    src="./assets/img/ico/car.png"
                                    alt="car"></a>
                            <a href="./analytics.html"><img
                                    src="./assets/img/ico/analytics.png"
                                    alt="analytics"></a>
                        </div>
                    </div>
                    <div class="navbar__links">
                        <div class="navbar__links-content">
                            <a href="#" class="support"><img
                                    src="./assets/img/ico/info.png"
                                    alt="info"></a>
                            <a href="#" class="settings"><img
                                    src="./assets/img/ico/settings.png"
                                    alt="settings"></a>
                            <a href="#" class="menu"><img
                                    src="./assets/img/ico/menu.png"
                                    alt="menu"></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="main">
                <div class="main__header">
                    <div class="main__header-logo"
                        style="width: 280px;">
                        <h3 style="font-size: 20px;">Водители</h3>
                    </div>
                    <div class="main__header-tags">
                        <ul>
                            <li><a href="./drivers.html">Водитель</a></li>
                            <li><a href="./cars.html">Автомобиль</a></li>
                            <li><a href="./drivers_control.html">Фото
                                    контроль</a></li>
                            <li>Тариф</li>
                            <li><a href="./chat.html">Чат</a></li>
                        </ul>
                    </div>
                    <div class="main__header-search">
                        <div class="main__header-search-item">
                            <form action="#">
                                <input type="search" placeholder="Поиск">
                                <button><img src="./assets/img/ico/search.png"
                                        alt="search"></button>
                            </form>
                        </div>
                        <div class="main__header-search-profile">
                            <div class="main__header-search-profile-item">
                                <a href="#"><img
                                        src="./assets/img/ico/notif.png"
                                        alt="notif"></a>
                            </div>
                            <div class="main__header-search-profile-item">
                                <a href="#"><img
                                        src="./assets/img/ico/user.png"
                                        alt="profile"></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="main__subheader main__subheader-drivers">
                    <div class="main__subheader-add">
                        <div class="main__header-search-item">
                            <form action="#" style="background-color: #47484c;">
                                <input type="search" placeholder="Поиск">
                                <button style="padding: 0px;"><img
                                        src="./assets/img/ico/search.png"
                                        alt="search"></button>
                            </form>
                        </div>
                        <div class="main__subheader-filing">
                            <form action="#">
                                <select name="filing-date">
                                    <option value="Статусы" disabled
                                        selected>Статусы</option>
                                    <option
                                        value="Занят">Занят</option>
                                    <option
                                        value="В ожидании">В ожидании</option>
                                </select>
                            </form>
                        </div>
                        <div class="main__subheader-filing">
                            <form action="#">
                                <select name="filing-date">
                                    <option value="Состояние" disabled
                                        selected>Состояние</option>
                                    <option
                                        value="Занят">Занят</option>
                                    <option
                                        value="В ожидании">В ожидании</option>
                                </select>
                            </form>
                        </div>
                    </div>
                    <div class="main__subheader-drivers">
                        <div
                            class="main__header-tags main__subheader-drivers-tags">
                            <ul>
                                <li>На линии 26 водителей</li>
                                <li><span class="status-span free"></span> 12
                                    свободный</li>
                                <li><span class="status-span busy"></span> 14
                                    занят</li>
                            </ul>
                        </div>
                        <div class="main__subheader-balance">
                            <img src="./assets/img/ico/balance.png"
                                alt="balance">
                            <p>
                                Баланс: 10,000
                            </p>
                        </div>
                    </div>
                </div>
                <div class="main__chat-wrapper">
                    <div class="main__table-wrapper main__chat-table-wrapper">
                        <div class="main__table main__getbalance-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 20px;"></th>
                                        <th>Статусы</th>
                                        <th>Состояние</th>
                                        <th>Позывной</th>
                                        <th>Ф.И.О</th>
                                        <th>Телефон</th>
                                        <th>СМС</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="driver-row" data-id="1">
                                        <td>
                                            <div class="custom-checkbox">
                                                <input type="checkbox"
                                                    class="custom-input driver-checkbox"
                                                    id="driver-1" data-id="1">
                                                <span class="checkmark"></span>
                                            </div>
                                        </td>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy"></span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#" class="send-sms-btn"
                                                data-id="1"
                                                data-name="Сергей Викторович Лавров"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr class="driver-row" data-id="2">
                                        <td>
                                            <div class="custom-checkbox">
                                                <input type="checkbox"
                                                    class="custom-input driver-checkbox"
                                                    id="driver-2" data-id="2">
                                                <span class="checkmark"></span>
                                            </div>
                                        </td>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy"></span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#" class="send-sms-btn"
                                                data-id="2"
                                                data-name="Сергей Викторович Лавров"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                    <tr>
                                        <td>Работает</td>
                                        <td class="status">
                                            <span
                                                class="status-span busy">
                                            </span>
                                            <span
                                                class="status-busy">Занят</span>
                                        </td>
                                        <td>Позывной</td>
                                        <td>Сергей Викторович Лавров</td>
                                        <td>+998 91 111 12 12</td>
                                        <td><a href="#"><img
                                                    src="./assets/img/ico/sms.png"
                                                    alt="sms"></a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="main__table-footer">
                            <div class="main__table-driver">
                                <button>Водители: 100</button>
                            </div>
                            <div class="main__table-pagination">
                                <div class="main__table-pagination-prev">
                                    <button><img src="./assets/img/ico/prev.png"
                                            alt="prev"></button>
                                </div>
                                <div
                                    class="main__table-pagination-active main__table-pagination-item">
                                    <button>1</button>
                                </div>
                                <div class="main__table-pagination-item">
                                    <button>2</button>
                                </div>
                                <div class="main__table-pagination-item">
                                    <button>3</button>
                                </div>
                                <div class="main__table-pagination-next">
                                    <button><img src="./assets/img/ico/next.png"
                                            alt="next"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        class="main__table main__getbalance-table main__chat-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Чат с водителем</th>
                                </tr>
                            </thead>
                        </table>
                        <table>
                            <thead>
                                <tr>
                                    <th>Время</th>
                                    <th>Ф.И.О</th>
                                    <th>СМС</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>10:10 1.06.2024</td>
                                    <td>Сергей Викторович Лавров</td>
                                    <td><a href="#"><img
                                                src="./assets/img/ico/sms.png"
                                                alt="sms"></a></td>
                                </tr>
                                <tr>
                                    <td>10:10 1.06.2024</td>
                                    <td>Сергей Викторович Лавров</td>
                                    <td><a href="#"><img
                                                src="./assets/img/ico/sms.png"
                                                alt="sms"></a></td>
                                </tr>

                                <tr>
                                    <td>10:10 1.06.2024</td>
                                    <td>Сергей Викторович Лавров</td>
                                    <td><a href="#"><img
                                                src="./assets/img/ico/sms.png"
                                                alt="sms"></a></td>
                                </tr>
                                <tr>
                                    <td>10:10 1.06.2024</td>
                                    <td>Сергей Викторович Лавров</td>
                                    <td><a href="#"><img
                                                src="./assets/img/ico/sms.png"
                                                alt="sms"></a></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="main__table-chat-group-wrapper">
                            <div class="main__table-chat-group">
                                <button
                                    class="main__btn message-type-btn active"
                                    id="message-btn">Сообщение</button>
                                <button class="main__btn message-type-btn"
                                    id="broadcast-btn">Рассылка</button>
                            </div>
                            <div class="main__table-chat-group">
                                <div
                                    class="main__subheader-filing main__subheader-filing-chat">
                                    <select name="recipient"
                                        id="recipient-select">
                                        <option value disabled selected>Выбрать
                                            пользователя</option>
                                        <option value="1">Сергей Викторович
                                            Лавров</option>
                                        <option value="2">Иван Иванович
                                            Иванов</option>
                                    </select>
                                </div>
                                <div
                                    class="main__subheader-filing main__subheader-filing-chat"
                                    style="display: none;">
                                    <select name="delivery-type"
                                        id="delivery-type-select">
                                        <option value="single"
                                            selected>Отправить
                                            выборочно</option>
                                        <option value="all">Всем</option>
                                    </select>
                                </div>
                            </div>
                            <div class="main__table-chat-group">
                                <form id="message-form">
                                    <textarea id="message-content"
                                        placeholder="Написать"
                                        class="chat-textarea"></textarea>
                                </form>
                            </div>
                            <div class="main__table-chat-group">
                                <button class="main__btn-green"
                                    id="send-btn">Отправить</button>
                                <button class="main__btn"
                                    id="cancel-btn">Отменить</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="./assets/js/script.js"></script>
        <script>
            $(document).ready(function() {
                // Инициализация базовых скриптов из script.js
                
                // Переключение типа сообщения (Сообщение/Рассылка)
                $('.message-type-btn').click(function() {
                    $('.message-type-btn').removeClass('active');
                    $(this).addClass('active');
                    
                    // Если выбрана рассылка, переключаем на отправку всем
                    if ($(this).attr('id') === 'broadcast-btn') {
                        $('#delivery-type-select').parent().show();
                        $('#recipient-select').parent().hide();
                        
                        // Автоматически выбираем режим "Всем" для рассылки
                        $('#delivery-type-select').val('all');
                        
                        // Снимаем выбор со всех чекбоксов
                        $('.driver-checkbox').prop('checked', false);
                    } else {
                        // Если выбрано личное сообщение - показываем селектор получателя
                        $('#delivery-type-select').parent().hide();
                        $('#recipient-select').parent().show();
                        
                        // Автоматически выбираем режим "Выборочно"
                        $('#delivery-type-select').val('single');
                    }
                });
                
                // Обработка нажатия на кнопку SMS у водителя
                $('.send-sms-btn').click(function(e) {
                    e.preventDefault();
                    
                    const driverId = $(this).data('id');
                    const driverName = $(this).data('name');
                    
                    // Переключаемся на режим личного сообщения
                    $('#message-btn').click();
                    
                    // Выбираем водителя в выпадающем списке
                    $('#recipient-select').val(driverId);
                    
                    // Фокусируемся на поле ввода сообщения
                    $('#message-content').focus();
                    
                    return false;
                });
                
                // Обработка изменения типа доставки
                $('#delivery-type-select').change(function() {
                    if ($(this).val() === 'all') {
                        // Снимаем выбор с конкретного получателя
                        $('#recipient-select').val('');
                        
                        // Снимаем все чекбоксы
                        $('.driver-checkbox').prop('checked', false);
                    }
                });
                
                // Обработка выбора водителя из выпадающего списка
                $('#recipient-select').change(function() {
                    if ($(this).val()) {
                        // Снимаем все чекбоксы
                        $('.driver-checkbox').prop('checked', false);
                        
                        // Устанавливаем чекбокс для выбранного водителя
                        $('#driver-' + $(this).val()).prop('checked', true);
                    }
                });
                
                // Обработка изменения чекбоксов водителей
                $('.driver-checkbox').change(function() {
                    const checkedDrivers = $('.driver-checkbox:checked');
                    
                    if (checkedDrivers.length === 1) {
                        // Если выбран только один водитель, устанавливаем его в выпадающем списке
                        $('#recipient-select').val(checkedDrivers.first().data('id'));
                        
                        // Переключаемся на режим личного сообщения
                        $('#message-btn').click();
                    } else if (checkedDrivers.length > 1) {
                        // Если выбрано несколько водителей, сбрасываем выпадающий список
                        $('#recipient-select').val('');
                        
                        // Переключаемся на режим рассылки выборочно
                        $('#broadcast-btn').click();
                        $('#delivery-type-select').val('single');
                    }
                });
                
                // Поиск по водителям
                $('input[type="search"]').on('input', function() {
                    const searchValue = $(this).val().toLowerCase();
                    
                    $('.driver-row').each(function() {
                        const name = $(this).find('td:nth-child(5)').text().toLowerCase();
                        const callsign = $(this).find('td:nth-child(4)').text().toLowerCase();
                        const phone = $(this).find('td:nth-child(6)').text().toLowerCase();
                        const status = $(this).find('td:nth-child(2)').text().toLowerCase();
                        
                        if (name.includes(searchValue) || 
                            callsign.includes(searchValue) || 
                            phone.includes(searchValue) ||
                            status.includes(searchValue)) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    });
                });
                
                // Фильтрация по статусу и состоянию
                $('select').change(function() {
                    filterDrivers();
                });
                
                function filterDrivers() {
                    const statusFilter = $('select[name="filing-date"]:eq(0)').val();
                    const stateFilter = $('select[name="filing-date"]:eq(1)').val();
                    
                    $('.driver-row').each(function() {
                        let showRow = true;
                        
                        if (statusFilter && statusFilter !== 'Статусы') {
                            const status = $(this).find('td:nth-child(3) span:last-child').text().trim();
                            if (!status.includes(statusFilter)) {
                                showRow = false;
                            }
                        }
                        
                        if (stateFilter && stateFilter !== 'Состояние') {
                            const state = $(this).find('td:nth-child(2)').text().trim();
                            if (state !== stateFilter) {
                                showRow = false;
                            }
                        }
                        
                        if (showRow) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    });
                }
                
                // Отправка сообщений
                $('#send-btn').click(function() {
                    const messageContent = $('#message-content').val().trim();
                    
                    if (!messageContent) {
                        alert('Пожалуйста, введите текст сообщения');
                        return;
                    }
                    
                    // Проверяем тип отправки
                    const isMessageMode = $('#message-btn').hasClass('active');
                    const isBroadcast = $('#delivery-type-select').val() === 'all';
                    
                    if (isMessageMode) {
                        // Режим личного сообщения - проверяем выбран ли получатель
                        const recipientId = $('#recipient-select').val();
                        
                        if (!recipientId) {
                            alert('Пожалуйста, выберите получателя');
                            return;
                        }
                        
                        // Отправка личного сообщения одному водителю
                        alert('Сообщение успешно отправлено водителю');
                    } else {
                        // Режим рассылки
                        if (isBroadcast) {
                            // Рассылка всем водителям
                            alert('Рассылка успешно отправлена всем водителям');
                        } else {
                            // Рассылка выбранным водителям
                            const selectedDriverIds = [];
                            
                            $('.driver-checkbox:checked').each(function() {
                                selectedDriverIds.push($(this).data('id'));
                            });
                            
                            if (selectedDriverIds.length === 0) {
                                alert('Пожалуйста, выберите хотя бы одного водителя');
                                return;
                            }
                            
                            // Отправка сообщения выбранным водителям
                            alert(`Рассылка успешно отправлена ${selectedDriverIds.length} водителям`);
                        }
                    }
                    
                    // Очистка формы
                    $('#message-content').val('');
                    $('.driver-checkbox').prop('checked', false);
                });
                
                // Очистка формы
                $('#cancel-btn').click(function() {
                    $('#message-content').val('');
                    $('#recipient-select').val('');
                    $('.driver-checkbox').prop('checked', false);
                    $('#message-btn').click();
                });
            });
        </script>
    </body>
</html>