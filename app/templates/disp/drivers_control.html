{% extends "base.html" %}

{% block title %}WAZIR MTT - Фото контроль водителей{% endblock %}

{% block header_title %}Фото контроль водителей{% endblock %}

{% block content %}
<div class="main__content">
    <div class="main__content-table">
        <div class="main__table-wrapper">
            <table class="main__table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ФИО</th>
                        <th>Позывной</th>
                        <th>Телефон</th>
                        <th>Статус</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for driver in drivers %}
                    <tr>
                        <td>{{ driver.id }}</td>
                        <td>{{ driver.full_name }}</td>
                        <td>{{ driver.callsign }}</td>
                        <td>{{ driver.phone }}</td>
                        <td>
                            <span
                                class="status status-{{ driver.status|lower }}">
                                {{ driver.status }}
                            </span>
                        </td>
                        <td>
                            <div class="actions">
                                <a href="#" class="view-photos"
                                    data-driver-id="{{ driver.id }}">
                                    <img
                                        src="{{ url_for('static', path='/assets/img/ico/view.png') }}"
                                        alt="Просмотр фото">
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Модальное окно для просмотра фотографий -->
<div id="photoModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Фотографии водителя</h2>
        <div class="photo-gallery">
            <div class="photo-category">
                <h3>Документы</h3>
                <div class="photo-grid">
                    <div class="photo-item">
                        <h4>Паспорт (лицевая сторона)</h4>
                        <div class="photo-container" id="passport-front"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Паспорт (обратная сторона)</h4>
                        <div class="photo-container" id="passport-back"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Водительское удостоверение (лицевая сторона)</h4>
                        <div class="photo-container" id="license-front"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Водительское удостоверение (обратная сторона)</h4>
                        <div class="photo-container" id="license-back"></div>
                    </div>
                </div>
            </div>
            <div class="photo-category">
                <h3>Автомобиль</h3>
                <div class="photo-grid">
                    <div class="photo-item">
                        <h4>Вид спереди</h4>
                        <div class="photo-container" id="car-front"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Вид сзади</h4>
                        <div class="photo-container" id="car-back"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Вид справа</h4>
                        <div class="photo-container" id="car-right"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Вид слева</h4>
                        <div class="photo-container" id="car-left"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Салон спереди</h4>
                        <div class="photo-container"
                            id="car-interior-front"></div>
                    </div>
                    <div class="photo-item">
                        <h4>Салон сзади</h4>
                        <div class="photo-container"
                            id="car-interior-back"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Открытие модального окна
        $('.view-photos').click(function(e) {
            e.preventDefault();
            const driverId = $(this).data('driver-id');
            
            // Очищаем контейнеры для фотографий
            $('.photo-container').empty();
            
            // Загрузка фотографий через API
            $.ajax({
                url: `/api/drivers/${driverId}/photos`,
                method: 'GET',
                success: function(data) {
                    // Заполнение контейнеров фотографиями
                    if (data.passport_front) {
                        $('#passport-front').html(`<img src="${data.passport_front}" alt="Паспорт (лицевая сторона)">`);
                    }
                    if (data.passport_back) {
                        $('#passport-back').html(`<img src="${data.passport_back}" alt="Паспорт (обратная сторона)">`);
                    }
                    if (data.license_front) {
                        $('#license-front').html(`<img src="${data.license_front}" alt="ВУ (лицевая сторона)">`);
                    }
                    if (data.license_back) {
                        $('#license-back').html(`<img src="${data.license_back}" alt="ВУ (обратная сторона)">`);
                    }
                    if (data.car_front) {
                        $('#car-front').html(`<img src="${data.car_front}" alt="Автомобиль спереди">`);
                    }
                    if (data.car_back) {
                        $('#car-back').html(`<img src="${data.car_back}" alt="Автомобиль сзади">`);
                    }
                    if (data.car_right) {
                        $('#car-right').html(`<img src="${data.car_right}" alt="Автомобиль справа">`);
                    }
                    if (data.car_left) {
                        $('#car-left').html(`<img src="${data.car_left}" alt="Автомобиль слева">`);
                    }
                    if (data.car_interior_front) {
                        $('#car-interior-front').html(`<img src="${data.car_interior_front}" alt="Салон спереди">`);
                    }
                    if (data.car_interior_back) {
                        $('#car-interior-back').html(`<img src="${data.car_interior_back}" alt="Салон сзади">`);
                    }
                    
                    // Показываем модальное окно
                    $('#photoModal').show();
                },
                error: function() {
                    alert('Ошибка загрузки фотографий');
                }
            });
        });
        
        // Закрытие модального окна
        $('.close').click(function() {
            $('#photoModal').hide();
        });
        
        // Закрытие модального окна при клике вне его
        $(window).click(function(e) {
            if ($(e.target).is('#photoModal')) {
                $('#photoModal').hide();
            }
        });
    });
</script>

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.7);
    }
    
    .modal-content {
        position: relative;
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        max-width: 1200px;
        max-height: 80vh;
        overflow-y: auto;
    }
    
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .photo-gallery {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .photo-category {
        margin-bottom: 20px;
    }
    
    .photo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .photo-item {
        display: flex;
        flex-direction: column;
    }
    
    .photo-container {
        height: 200px;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f5f5f5;
    }
    
    .photo-container img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }
</style>
{% endblock %}